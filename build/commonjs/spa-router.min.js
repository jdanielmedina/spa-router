function onchange(t){for(var e=Listener.listeners,r=0,n=e.length;n>r;r++)e[r](t)}function handler(t){var e,r=this.options.mode;switch(r){case"history":e=Loc.pathname+Loc.search+Loc.hash,"/"!==e.substr(0,1)&&(e="/"+e);break;case"hashbang":default:var n=Loc.hash.slice(1);if(""===n||"!"===n)return this.redirect(this.options.root);var i=t&&t.newURL||Loc.hash;e=i.replace(/.*#!/,"")}this.dispatch("/"===e.charAt(0)?e:"/"+e)}function findNode(t,e,r){r=!!r;for(var n,i=e.split("/"),s=null,a=!1,o=t,c=0,h=i.length;h>c;++c){n=!1;var l=i[c],u=/:([a-zA-Z_][a-zA-Z0-9_]*)(\([^\)]+\))?/g,f=0;l=l.replace(u,function(t,e,r){return n=n||[],n[f++]=e,"undefined"==typeof r?"([a-zA-Z0-9_]+)":r});for(var p=0;p<o._children.length;++p)if(o._children[p].value===l){s=o._children[p],a=!0;break}if(!a){if(r)return!1;var d=new RNode(l);o.children(d),d.parent(o),d.params=n,s=d}o=s,a=!1}return s}function createRouteTree(t,e){if(isFunction(e))return t.callbacks=[e],t;if(isArray(e))return t.callbacks=e,t;for(var r in e)if(hasOwn.call(e,r)){var n=e[r];"/"===r?createRouteTree(t,n):(""!==r&&"/"===r[0]&&(r=r.slice(1)),createRouteTree(findNode(t,r),n))}return t}function dfs(t,e,r,n,i){var s=e[r],a={};for(var o in i)hasOwn.call(i,o)&&(a[o]=i[o]);var c=t.parent();if(null===c&&n>0)return[!1,a];if(null!==c&&n>c._children.length-1)return[!1,a];if(r>e.length-1||0>r)return[!1,a];var h=new RegExp("^"+t.value+"$"),l=s.match(h);if(null===l)return[!1,a];if(t.params){l=[].slice.apply(l,[1]);for(var u=0;u<l.length;++u)a[t.params[u]]=l[u]}if(r===e.length-1&&null!==t.callbacks)return[t,a];for(var f=0;f<t._children.length;++f){var p=dfs(t._children[f],e,r+1,f,a);if(p[0])return p}return dfs(t,e,r,n+1,i)}function searchRouteTree(t,e){var r=dfs(t,e.split("/"),0,0,{});return r[0]?[r[0].callbacks,r[1]]:[null,{}]}var Win=window,Loc=Win.location,toString=Object.prototype.toString,decodeC=Win.decodeURIComponent,encodeC=Win.encodeURIComponent,TYPE_UNDEFINED="undefined",hasOwn=Object.prototype.hasOwnProperty,isArray=function(t){return"[object Array]"===toString.call(t)},isFunction=function(t){return"[object Function]"===toString.call(t)},extend=function(){for(var t={},e=[].slice.call(arguments,0),r=0,n=e.length;n>r;++r){var i=e[r];for(var s in i)hasOwn.call(i,s)&&(t[s]=i[s])}return t},addEvent=function(t,e){Win.addEventListener?Win.addEventListener(t,e,!1):Win.attachEvent?Win.attachEvent("on"+t,e):Win["on"+t]=e},queryHelper={parse:function(t){if("string"!=typeof t)return{};if(t=t.replace(/^\s*|\s*$/g,"").replace(/^(\?|#)/,""),!t)return{};for(var e=t.split("&"),r={},n=0,i=e.length;i>n;++n){var s=e[n].replace(/\+/g," ").split("="),a=s[0],o=s[1];a=decodeC(a),o=void 0===o?null:decodeC(o),hasOwn.call(r,a)?isArray(r[a])?r[a].push(o):r[a]=[r[a],o]:r[a]=o}return r},stringify:function(t){if(!t)return"";var e=[];for(var r in t)hasOwn.call(t,r)&&e.push(r);e.sort();for(var n=[],i=0,s=e.length;s>i;++i){var a=e[i],o=t[a];if(isArray(o)){o.sort();for(var c=[],h=0,l=o.length;l>h;++h)c.push(encodeC(a)+"="+encodeC(o[h]));n.push(c.join("&"))}else n.push(encodeC(a)+"="+encodeC(o))}return n.join("&")}},RNode=function(t){if(typeof t===TYPE_UNDEFINED)throw new TypeError("The RNode Constructor Need A Value.");this.value=t,this.params={},this.callbacks=null,this.before=null,this.after=null,this._children=[],this._parent=null},nprtt=RNode.prototype;nprtt.children=function(t){return typeof t===TYPE_UNDEFINED?this._children:(t instanceof RNode?this._children.push(t):isArray(t)&&(this._children=this.children.concat(t)),this)},nprtt.parent=function(t){return typeof t===TYPE_UNDEFINED?this._parent:(t instanceof RNode&&(this._parent=t),this)};var historySupport=typeof Win.history.pushState!==TYPE_UNDEFINED,Listener={listeners:null,history:!1,init:function(t){return this.history="history"===t,this.history&&historySupport?addEvent("popstate",onchange):addEvent("hashchange",onchange),this},add:function(t){return this.listeners||(this.listeners=[]),this.listeners.push(t),this},setHashHistory:function(t){if(this.history)history.pushState({},document.title,t);else if("/"===t[0])Loc.hash="!"+t;else{var e=Loc.hash.slice(2),r=e.indexOf("?");if(-1!==r&&(e=e.slice(0,r)),/.*\/$/.test(e))Loc.hash="!"+e+t;else{var n=e.replace(/([^\/]+|)$/,function(e){return""===e?"/"+t:t});Loc.hash="!"+n}}return this}},defaults={root:"/",mode:"hashbang",notFound:!1,recurse:!1},Router=exports.Router=function(t){if(t=t||{},!(this instanceof Router))return new Router(t);var e=new RNode("");e.params=!1,this.routeTree=createRouteTree(e,t),this.options={},this.configure(defaults)},rprtt=Router.prototype;rprtt.configure=function(t){return t=t||{},this.options=extend(this.options,t),this},rprtt.start=function(t){t=t||{};var e=this;return this.configure(t),Listener.init(this.options.mode).add(function(){return handler.call(e)}),handler.call(this),this},rprtt.mount=function(t,e){return""!==t&&"/"===t[0]&&(t=t.slice(1)),createRouteTree(findNode(this.routeTree,t),e),this},rprtt.on=function(t,e){""!==t&&"/"===t[0]&&(t=t.slice(1));var r=findNode(this.routeTree,t);return r.callbacks=r.callbacks||[],isArray(e)?r.callbacks=r.callbacks.concat(e):isFunction(e)&&r.callbacks.push(e),this},rprtt.dispatch=function(t){var e=this.routeTree,r=t,n=t.indexOf("?"),i=t.indexOf("#");i=-1===i?t.length:i;var s=-1===n?"":t.slice(n+1,i);t=-1===n?t:t.slice(0,n);var a={uri:r,path:t,query:queryHelper.parse(s)};"/"===t&&(t="");var o=searchRouteTree(e,t),c=o[0];if(a.params=o[1],null!==c){if(!isArray(c))throw new TypeError("callbacks must be an array type");for(var h=0,l=c.length;l>h;++h)c[h].call(this,a)}else this.options.notFound&&this.options.notFound(a);return this},rprtt.setRoute=function(t){var e=window.location,r=e.pathname+e.search;Listener.setHashHistory(t);var n=e.pathname+e.search;return"history"===this.options.mode&&r!==n&&this.dispatch(n),this},rprtt.redirect=rprtt.setRoute,rprtt.once=function(t,e){return this},rprtt.off=function(t){""!==t&&"/"===t[0]&&(t=t.slice(1));var e=findNode(this.routeTree,t);return null!==e&&null!==e.callbacks&&e.callbacks.splice(0,e.callbacks.length),this},rprtt.reload=function(){var t=window.location;return"history"===this.options.mode?this.dispatch(t.pathname+t.search+t.hash):this.dispatch(t.hash.slice(1)),this};
//# sourceMappingURL=spa-router.min.js.map