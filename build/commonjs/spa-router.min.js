function onchange(t){for(var e=Listener.listeners,r=0,n=e.length;n>r;r++)e[r](t)}function findNode(t,e,r){r=!!r;for(var n,i=e.split("/"),o=null,a=!1,s=t,c=0,h=i.length;h>c;++c){n=!1;var l=i[c],u=/:([a-zA-Z_][a-zA-Z0-9_]*)(\([^\)]+\))?/g,d=0;l=l.replace(u,function(t,e,r){return n=n||[],n[d++]=e,"undefined"==typeof r?"([a-zA-Z0-9_]+)":r});for(var f=0;f<s._children.length;++f)if(s._children[f].value===l){o=s._children[f],a=!0;break}if(!a){if(r)return!1;var p=new RNode(l);s.children(p),p.parent(s),p.params=n,o=p}s=o,a=!1}return o}function createRouteTree(t,e){if(isFunction(e))return t.callbacks=[e],t;if(isArray(e))return t.callbacks=e,t;for(var r in e)if(hasOwn.call(e,r)){var n=e[r];"/"===r?createRouteTree(t,n):(""!==r&&"/"===r[0]&&(r=r.slice(1)),createRouteTree(findNode(t,r),n))}return t}function dfs(t,e,r,n,i){var o=e[r],a={};for(var s in i)hasOwn.call(i,s)&&(a[s]=i[s]);var c=t.parent();if(null===c&&n>0)return[!1,a];if(null!==c&&n>c._children.length-1)return[!1,a];if(r>e.length-1||0>r)return[!1,a];var h=new RegExp("^"+t.value+"$"),l=o.match(h);if(null===l)return[!1,a];if(t.params){l=[].slice.apply(l,[1]);for(var u=0;u<l.length;++u)a[t.params[u]]=l[u]}if(r===e.length-1&&null!==t.callbacks)return[t,a];for(var d=0;d<t._children.length;++d){var f=dfs(t._children[d],e,r+1,d,a);if(f[0])return f}return dfs(t,e,r,n+1,i)}function searchRouteTree(t,e){var r=dfs(t,e.split("/"),0,0,{});return r[0]?[r[0].callbacks,r[1]]:[null,{}]}var Win=window,toString=Object.prototype.toString,decodeC=Win.decodeURIComponent,encodeC=Win.encodeURIComponent,hasOwn=Object.prototype.hasOwnProperty,isArray=function(t){return"[object Array]"===toString.call(t)},isFunction=function(t){return"[object Function]"===toString.call(t)},extend=function(){for(var t={},e=[].slice.call(arguments,0),r=0,n=e.length;n>r;++r){var i=e[r];for(var o in i)hasOwn.call(i,o)&&(t[o]=i[o])}return t},addEvent=function(t,e){Win.addEventListener?Win.addEventListener(t,e,!1):Win.attachEvent?Win.attachEvent("on"+t,e):Win["on"+t]=e},queryHelper={parse:function(t){if("string"!=typeof t)return{};if(t=t.replace(/^\s*|\s*$/g,"").replace(/^(\?|#)/,""),!t)return{};for(var e=t.split("&"),r={},n=0,i=e.length;i>n;++n){var o=e[n].replace(/\+/g," ").split("="),a=o[0],s=o[1];a=decodeC(a),s=void 0===s?null:decodeC(s),hasOwn.call(r,a)?isArray(r[a])?r[a].push(s):r[a]=[r[a],s]:r[a]=s}return r},stringify:function(t){if(!t)return"";var e=[];for(var r in t)hasOwn.call(t,r)&&e.push(r);e.sort();for(var n=[],i=0,o=e.length;o>i;++i){var a=e[i],s=t[a];if(isArray(s)){s.sort();for(var c=[],h=0,l=s.length;l>h;++h)c.push(encodeC(a)+"="+encodeC(s[h]));n.push(c.join("&"))}else n.push(encodeC(a)+"="+encodeC(s))}return n.join("&")}},RNode=function(t){if("undefined"==typeof t)throw new TypeError("The RNode Constructor Need A Value.");this.value=t,this.params={},this.callbacks=null,this.before=null,this.after=null,this._children=[],this._parent=null},nprtt=RNode.prototype;nprtt.children=function(t){return"undefined"==typeof t?this._children:(t instanceof RNode?this._children.push(t):isArray(t)&&(this._children=this.children.concat(t)),this)},nprtt.parent=function(t){return"undefined"==typeof t?this._parent:(t instanceof RNode&&(this._parent=t),this)};var historySupport="undefined"!=typeof Win.history,Listener={listeners:null,history:!1,init:function(t){return this.history="history"===t,this.history&&historySupport?addEvent("popstate",onchange):addEvent("hashchange",onchange),this},add:function(t){return this.listeners||(this.listeners=[]),this.listeners.push(t),this},setHashHistory:function(t){if(this.history)history.pushState({},document.title,t);else if("/"===t[0])Win.location.hash=t;else{var e=Win.location.hash,r=e.indexOf("?");if(-1!==r&&(e=e.slice(0,r)),/.*\/$/.test(e))Win.location.hash=e+t;else{var n=e.replace(/([^\/]+|)$/,function(e){return""===e?"/"+t:t});Win.location.hash=n}}return this}},defaults={mode:"default",notFound:!1,always:!1,on:!1,before:!1,after:!1,recurse:!1},Router=exports.Router=function(t){if(t=t||{},!(this instanceof Router))return new Router(t);var e=new RNode("");e.params=!1,this.routeTree=createRouteTree(e,t),this.options={},this.configure(defaults)},rprtt=Router.prototype;rprtt.configure=function(t){return t=t||{},this.options=extend(this.options,t),this},rprtt.init=function(t){t=t||{};var e=this;return this.configure(t),this.handler=function(t){var r,n=t&&t.newURL||window.location.hash;switch(e.options.mode){case"history":r=window.location.pathname+window.location.search+window.location.hash,"/"!==r.substr(0,1)&&(r="/"+r);break;case"hashbang":r=n.replace(/.*#!/,"");break;default:r=n.replace(/.*#/,"")}e.dispatch("/"===r.charAt(0)?r:"/"+r)},Listener.init(this.options.mode).add(this.handler),this.handler(),this},rprtt.mount=function(t,e){return""!==t&&"/"===t[0]&&(t=t.slice(1)),createRouteTree(findNode(this.routeTree,t),e),this},rprtt.on=rprtt.route=function(t,e){""!==t&&"/"===t[0]&&(t=t.slice(1));var r=findNode(this.routeTree,t);return r.callbacks=r.callbacks||[],isArray(e)?r.callbacks=r.callbacks.concat(e):isFunction(e)&&r.callbacks.push(e),this},rprtt.dispatch=function(t){var e=this.routeTree,r=t,n=t.indexOf("?"),i=t.indexOf("#");i=-1===i?t.length:i;var o=-1===n?"":t.slice(n+1,i);t=-1===n?t:t.slice(0,n);var a={uri:r,path:t,query:queryHelper.parse(o)};"/"===t&&(t="");var s=searchRouteTree(e,t),c=s[0];if(a.params=s[1],null!==c){if(!isArray(c))throw new TypeError("callbacks must be an array type");for(var h=0,l=c.length;l>h;++h)c[h].call(this,a)}else this.options.notFound&&this.options.notFound(a);return this},rprtt.setRoute=function(t){var e=window.location,r=e.pathname+e.search;Listener.setHashHistory(t);var n=e.pathname+e.search;return"history"===this.options.mode&&r!==n&&this.dispatch(n),this},rprtt.redirect=rprtt.setRoute,rprtt.once=function(t,e){return this},rprtt.off=function(t){""!==t&&"/"===t[0]&&(t=t.slice(1));var e=findNode(this.routeTree,t);return null!==e&&null!==e.callbacks&&e.callbacks.splice(0,e.callbacks.length),this},rprtt.reload=function(){var t=window.location;return this.dispatch("history"===this.options.mode?t.pathname+t.search+t.hash:t.hash.slice(1)),this};
//# sourceMappingURL=spa-router.min.js.map