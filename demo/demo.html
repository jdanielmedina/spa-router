<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>router.js</title>
  <link rel="stylesheet" href="css/demo.css">
</head>
<body>
  <div id="main-container">
    <table>
      <thead>
        <tr>
          <th style="width: 25%;">uri</th>
          <th style="width: 25%;">path</th>
          <th style="width: 25%;">param</th>
          <th style="width: 25%;">query</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td data-uri>-</td>
          <td data-path>-</td>
          <td data-param>-</td>
          <td data-query>-</td>
        </tr>
      </tbody>
    </table>

    <ul>
      <li><a href="#/home">Home</a></li>
      <li><a href="#/my/god/hah">My God</a></li>
      <li><a href="#/your/shoes-white">Your</a></li>
      <li><a href="#/his/coc=white">His</a></li>
      <li><a href="#/user">user list</a></li>
      <li><a href="#/user/123">User 123</a></li>
      <li><a href="#/user/add">User Add</a></li>
      <li><a href="#/user/edit/123">User Edit</a></li>
      <li><a href="#/list/red-123-456">list</a></li>
      <li><a href="#/test?mode=debug">Test Mode</a></li>
    </ul>
    <h2>使用不同分隔符</h2>
    <ul>
      <li><a href="#/test/a/b/c">/a/b/c</a></li>
      <li><a href="#/test/a&b&c">/a&b&c</a></li>
      <li><a href="#/test/a!b!c">/a!b!c</a></li>
      <li><a href="#/test/a=b=c">/a=b=c</a></li>
      <li><a href="#/test/a@b@c">/a@b@c</a></li>
      <li><a href="#/test/hello@world">/hello@world</a></li>
    </ul>
  </div>
  <script src="../src/zrouter.js"></script>
  <script>

  var mainContainer = document.querySelectorAll('#main-container')[0];
  var uri = mainContainer.querySelectorAll('[data-uri]')[0];
  var path = mainContainer.querySelectorAll('[data-path]')[0];
  var param = mainContainer.querySelectorAll('[data-param]')[0];
  var query = mainContainer.querySelectorAll('[data-query]')[0];

  function process (req) {
    uri.innerText = req.uri;
    path.innerText = req.path;
    var params = '';
    for (var i = 0; i < req.params.length; ++i) {
      params += req.params[i] + ' ';
    }
    param.innerText = params;
    var querys = '';
    for (var p in req.query) {
      querys += p + ': ' + req.query[p];
    }
    query.innerText = querys;
  }

  var routes = {
    '/': process,
    '/home': process,
    '/my/:god/:what': process,
    '/your/:shit-:what': process,
    '/his/:shit=:what': process,
    // 不同分隔符分割参数
    '/test/:p1/:p2/:p3': function(req) {
      process.call(this, req);
      this.redirect('/test/a&b&c'); // 重定向到 /test/a&b&c
    },
    '/test/:p1&:p2&:p3': process,
    '/test/:p1!:p2!:p3': process,
    '/test/:p1=:p2=:p3': process,
    '/test/:p1@:p2@:p3': process,

    '/test/hello@world': process,

    '/test/:what/:is/:that': process,

    '/pattern/([^\/]+)\/([0-9]+)': process,
    
    '/user': {
      on: function() {
        console.log('user list');
      },
      '/add': function() {
        console.log('user add');
      },
      '/edit/:id': function(id) {
        console.log('user ' + id + ' edit');
      }
    }
  };
  // 使用new创建路由器对象
  var router = new Router(routes);
  // 定义参数1
  router.param('id', /[0-9]+/);
  // 定义参数2
  router.param({
    'name': /[a-zA-Z]+/,
    'age': /[0-9]+/
  });
  // 定义参数3
  router.param(['color', 'width', 'height'], /(#[0-9a-zA-Z]{6})-([0-9]+)-([0-9]+)/);
  // 配置
  router.configure({
    // 是否启用HTML5 History API
    history: false,
    // 找不到路由时执行
    notFound: function() {
      console.log('nothing matched.');
    },
    // 只要找到路由就执行
    on: function() {
      console.log('Always do something.');
    }
  });
  // 动态添加路由
  router.on('/user/:id', [function(id) {
    console.log('user home');
  }, function(id) {
    console.log('current user: ' + id);
  }]);
  // 使用'-'分割参数
  router.route('/list/:color-:width-:height', function(color, width, height) {
    console.log('list type: ' + color + ' ' + width + ' ' + height);
  });
  // 捕获query参数
  router.route('/test', function(params) {
    console.log('Current mode: ' + params.mode);
  });
  // 创建多个路由器对象（互不影响），支持使用工厂方法（不用new）
  var router2 = Router({
    '/before': {
      on: function() {
        console.log('going...');
      },
      before: function() {
        console.log('before...');
      },
      after: function() {
        console.log('after...');
      }
    }
  });
  // 路由初始化方法
  // 如果一个路径对应多个路由器，则按照路由器初始化先后顺序执行
  router.init();
  // router2.init();

  </script>
</body>
</html>