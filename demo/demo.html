<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>router.js</title>
  <link rel="stylesheet" href="css/demo.css">
</head>
<body>
  <div id="main-container">
    <table>
      <thead>
        <tr>
          <th style="width: 25%;">uri</th>
          <th style="width: 25%;">path</th>
          <th style="width: 25%;">param</th>
          <th style="width: 25%;">query</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td data-uri>-</td>
          <td data-path>-</td>
          <td data-param>-</td>
          <td data-query>-</td>
        </tr>
      </tbody>
    </table>

    <h2>Web Example</h2>
    <ul>
      <li><a href="#/">Home</a></li>
      <li><a href="#/product">Product List</a></li>
      <li><a href="#/product/red-small-low">Category Product List</a></li>
      <li><a href="#/product?color=red&size=small&price=low">Category Product List With Query</a></li>
      <li><a href="#/product/12345">Product Detail</a></li>
      <li><a href="#/about">About</a></li>
    </ul>
    <h2>Admin Example</h2>
    <ul>
      <li><a href="#/admin">Admin Home</a></li>
      <li><a href="#/admin/product">Admin Product List</a></li>
      <li><a href="#/admin/product?page=3">Admin Product List With Query</a></li>
      <li><a href="#/admin/product/red-small-low">Admin Category Product List</a></li>
      <li><a href="#/admin/product/red-small-low?page=2">Admin Category Product List With Query</a></li>
      <li><a href="#/admin/product/add">Admin Product Add</a></li>
      <li><a href="#/admin/product/12345">Admin Product Edit</a></li>
    </ul>
    <h2>Separators</h2>
    <ul>
      <li><a href="#/test/a/b/c">/test/a/b/c</a></li>
      <li><a href="#/test/a&b&c">/test/a&b&c</a></li>
      <li><a href="#/test/a!b!c">/test/a!b!c</a></li>
      <li><a href="#/test/a=b=c">/test/a=b=c</a></li>
      <li><a href="#/test/a@b@c">/test/a@b@c</a></li>
      <li><a href="#/test/hello@world&and!hahaha=shit">/test/hello@world&and!hahaha=shit</a></li>
    </ul>
  </div>
  <script src="../src/zrouter.js"></script>
  <script>

  var mainContainer = document.querySelectorAll('#main-container')[0];
  var uri = mainContainer.querySelectorAll('[data-uri]')[0];
  var path = mainContainer.querySelectorAll('[data-path]')[0];
  var param = mainContainer.querySelectorAll('[data-param]')[0];
  var query = mainContainer.querySelectorAll('[data-query]')[0];

  function process (req) {
    uri.innerText = req.uri;
    path.innerText = req.path;
    var params = req.params.join(',');
    param.innerText = params;
    var querys = '';
    for (var p in req.query) {
      querys += p + ': ' + req.query[p] + '<br>';
    }
    querys = querys === '' ? '-' : querys;
    query.innerHTML = querys;
  }

  var baseExampleRoutes = {
    // web
    '/': process,
    '/product': process,
    '/product/:color-:size-:price': process,
    '/product/:id': process,
    '/about': process,
    // admin
    '/admin': process,
    '/admin/product': process,
    '/admin/product/:color-:size-:price': process,
    '/admin/product/add': process,
    '/admin/product/:id': process
  };

  var baseExampleRouter = Router(baseExampleRoutes);
  baseExampleRouter.init();

  var separatorExampleRoutes = {
    '/test/:p1/:p2/:p3': process,
    '/test/:p1&:p2&:p3': process,
    '/test/:p1!:p2!:p3': process,
    '/test/:p1=:p2=:p3': process,
    '/test/:p1@:p2@:p3': process,
    '/test/hello@world&and!hahaha=shit': process
  };

  var separatorExampleRouter = Router(separatorExampleRoutes);
  separatorExampleRouter.init();

  var routes = {

    '/pattern/([^\/]+)\/([0-9]+)': process,
    
    '/user': {
      on: function() {
        console.log('user list');
      },
      '/add': function() {
        console.log('user add');
      },
      '/edit/:id': function(id) {
        console.log('user ' + id + ' edit');
      }
    }
  };
  // 使用new创建路由器对象
  var router = new Router(routes);
  // 定义参数1
  router.param('id', /[0-9]+/);
  // 定义参数2
  router.param({
    'name': /[a-zA-Z]+/,
    'age': /[0-9]+/
  });
  // 定义参数3
  router.param(['color', 'width', 'height'], /(#[0-9a-zA-Z]{6})-([0-9]+)-([0-9]+)/);
  // 配置
  router.configure({
    // 是否启用HTML5 History API
    history: false,
    // 找不到路由时执行
    notFound: function() {
      console.log('nothing matched.');
    },
    // 只要找到路由就执行
    on: function() {
      console.log('Always do something.');
    }
  });
  // 动态添加路由
  router.on('/user/:id', [function(id) {
    console.log('user home');
  }, function(id) {
    console.log('current user: ' + id);
  }]);
  // 创建多个路由器对象（互不影响），支持使用工厂方法（不用new）
  var router2 = Router({
    '/before': {
      on: function() {
        console.log('going...');
      },
      before: function() {
        console.log('before...');
      },
      after: function() {
        console.log('after...');
      }
    }
  });
  // 路由初始化方法
  // 如果一个路径对应多个路由器，则按照路由器初始化先后顺序执行
  // router.init();
  // router2.init();

  </script>
</body>
</html>